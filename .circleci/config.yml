version: 2.1

# You are unable to use one config file for dynamic config
# The setup: true key will cause the continued pipeline
# to fail

setup: true

parameters:
  run-path-a:
    type: boolean
    default: false
  run-path-b:
    type: boolean
    default: false

orbs:
  path-filtering: circleci/path-filtering@1.0.0

executors:
  base:
    docker:
      - image: cimg/base:stable

jobs:
  job_a:
    executor: base
    steps:
      - checkout
      - run: echo "Running job a"
      - run: cat path_a/README.md
  job_b:
    executor: base
    steps:
      - checkout
      - run: echo "running job b"
      - run: cat path_b/README.md

workflows:
  setup-workflow:
    jobs:
      - path-filtering/filter:
          name: check path
          mapping: |
            path_a/.* run-path-a true
            path_b/.* run-path-b true
          # Default base-revision is main, but in this case
          # that would cause both workflows to run each time
          base-revision: << pipeline.git.base_revision >>
          config-path: .circleci/config.yml
  workflow-a:
    when: << pipeline.parameters.run-path-a >>
    jobs:
      - job_a
  workflow-b:
    when: << pipeline.parameters.run-path-b >>
    jobs:
      - job_b
